<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>数字能量解说查询系统</title>
  <style>
    body {
      font-family: "Microsoft YaHei", sans-serif;
      background: #fafafa;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 {
      color: #333;
      font-size: 24px;
    }
    input {
      padding: 10px;
      font-size: 16px;
      width: 200px;
      margin-top: 20px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-left: 5px;
      cursor: pointer;
      background-color: #0078d7;
      color: white;
      border: none;
      border-radius: 4px;
    }
    .result {
      margin-top: 30px;
      text-align: left;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .title { font-weight: bold; color: #0078d7; margin-bottom: 6px; }
    .sub-title { color: #555; font-size: 16px; margin-top: 15px; }
  </style>
</head>
<body>
  <h1>数字解说查询系统</h1>
  <p>— 搜索数字或关键词（例如：1、112、沟通、行动）</p>
  <input id="num" type="text" placeholder="请输入数字或关键词" />
  <button onclick="search()">查询</button>
  <div id="result" class="result"></div>

  <script>
    let dataCache = null;

    async function search() {
      const input = document.getElementById("num").value.trim();
      if (!input) {
        alert("请输入数字或关键词！");
        return;
      }

      const resultDiv = document.getElementById("result");
      if (!dataCache) {
        try {
          const res = await fetch("data.json");
          dataCache = await res.json();
        } catch {
          resultDiv.innerHTML = "<p>⚠️ 数据加载失败，请确认 JSON 文件存在。</p>";
          return;
        }
      }

      let output = "";

      // 如果是数字（例如 1、112）
      if (!isNaN(input)) {
        const main = dataCache[input];
        if (main) {
          output += `<div class="title">${main.title}号能量</div>`;
          output += `<p>${main.summary}</p>`;
          output += `<p>${main.detail}</p>`;
        } else {
          // 查找子号
          for (let key in dataCache) {
            const subs = dataCache[key].subs;
            if (subs && subs[input]) {
              const s = subs[input];
              output += `<div class="title">${input}</div>`;
              output += `<div><b>正：</b>${s.pos}</div>`;
              output += `<div><b>负：</b>${s.neg}</div>`;
              output += `<div><b>解说：</b>${s.explain}</div>`;
              break;
            }
          }
        }
      } else {
        // 模糊搜索关键词
        for (let k in dataCache) {
          const m = dataCache[k];
          if (m.summary.includes(input) || m.detail.includes(input)) {
            output += `<div class="sub-title">匹配：${m.title}</div>`;
            output += `<p>${m.summary}</p>`;
          }
          for (let sub in m.subs) {
            const s = m.subs[sub];
            if (s.pos.includes(input) || s.neg.includes(input) || s.explain.includes(input)) {
              output += `<div class="sub-title">匹配：${sub}</div>`;
              output += `<div><b>正：</b>${s.pos}</div>`;
              output += `<div><b>负：</b>${s.neg}</div>`;
              output += `<div><b>解说：</b>${s.explain}</div>`;
            }
          }
        }
      }

      resultDiv.innerHTML = output || "<p>未找到相关解说，请确认输入是否正确。</p>";
    }
  </script>
</body>
</html>
